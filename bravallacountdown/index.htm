<!DOCTYPE html>
<html>
<head>
  <title>Hi there</title>

  <!-- Jquery -->
  <script src="jquery/jquery-2.1.4.min.js"></script>

  <!-- Bootstrap -->
  <link rel="stylesheet" href="bootstrap/bootstrap.min.css">
  <link rel="stylesheet" href="bootstrap/bootstrap-theme.min.css">
  <script src="bootstrap/bootstrap.min.js"></script>

  <!-- Pongstagr 
  <link rel="stylesheet" href="pongstagr/pongstagr.am.css">
  <script src="pongstagr/pongstagr.am.js"></script>
  -->



  <script type="text/javascript" src="js/instafeed.min.js"></script>
  -->

  <style type="text/css">

      ul.images div#instafeed {
        margin      : 0px;
        overflow-x  : hidden;
        padding     : 0px;
        white-space : nowrap;
        width       : 100%;
      }

      ul.images div#instafeed li {
        display: inline;
      }

      ul.images div#instafeed li a img {
        width   : 70px;
        height  : 70px;
        /*padding : 1px;*/
    }

    ul.images {
      padding-left: 0px;
    }


      ul.images div#instafeed_ugly {
        margin      : 0px;
        overflow-x  : hidden;
        padding     : 0px;
        white-space : nowrap;
        width       : 100%;
      }

      ul.images div#instafeed_ugly li {
        display: inline;
      }

      ul.images div#instafeed_ugly li a img {
        width   : 70px;
        height  : 70px;
        /*padding : 1px;*/
    }

    #canvas {
      display: none;
    }
  </style>

</head>
<body>

<div id="top" style="height:77px; border-bottom:solid; border-color:#edeeee;border-width:1px">
  <center style="padding-top:25px">Time to Br책valla 2016 : long long long ;)</center>
</div>

  <div id="main" style="background-color:#fafafa;padding-top:0px;height:82vh;">
    <br>
    <strong>#br책valla2013</strong>
    <ul class="images">
      <div id="instafeed"></div>
    </ul>
    <br><br><br>
    <ul class="images">
      <div id="instafeed_ugly"></div>
    </ul>

<!--
    <ul class="images">
      <div id="instafeed"></div>

      <div id="below_feed">
        <span style="float:right">randomize</span>
      </div>
    </ul>

-->
  </div>

    



<canvas id="canvas"></canvas>
<script type="text/javascript">

  //var width  = $(window).width();
  //var images = Math.floor(width/50);
  //    images = 60;

  // set interval
//  var interval = setInterval(refresh_images, 10000);
//
//  function refresh_images() {
//    var viewport_width = '0';
//    var image_left    = '1';
//
//    while ( image_left > viewport_width ){
//      // Get the actual viewport,
//      viewport_width = $(window).width();
//
//      // Get a random picture,
//      item = $('#instafeed li')[Math.floor(Math.random()*$('#instafeed li').length)];
//
//      // Get the position,
//      image_left = $(item).position().left;
//      console.log(image_left + "vs" + viewport_width);
//    }
//
//    console.log("fetch is being called");
//    // fetch_image("br책valla2013", item);
//
//    ////("#instafeed_ugly").append('<li><a href="'+probably_white_border+'"><img src="'+image.images.thumbnail.url+'" style="border:solid"></a></li>');
//  }

//  function fetch_image(tag, item){
//    var afeed = new Instafeed({
//        get       : 'tagged',
//        tagName   : tag,
//        clientId  : 'eb01b1b10b72457ea650f74f756bde4a',
//        sortBy    : 'random',
//        links     : 'true',
//        limit     : '10',
//        //template: '<li><a href="{{link}}"><img src="{{image}}"/></a></li>',
//
//        filter: function(image) {
//
//          //console.log(image.images.thumbnail.url)
//          var img = new Image();
//
//          img.addEventListener("load", function() {
//
//            // Draw the picture in the canvas element,
//            var context = document.getElementById('canvas').getContext('2d');
//                context.drawImage(img, 0, 0);
//
//            // Get a rectangle 10 pixels wide from top to bottom,
//            var pixels = context.getImageData(0, 0, 10, canvas.height).data;
//                console.log(context);
//
//            // Loop the pixels from the rectangle, if there is to much white we
//            // *could be* dealing with a white frame, simply skip that image.
//            // 500 is value that seems to do what I want, feel free to improve
//            // this part though.
//            var probably_white_border = 0;
//            for (var i = 0, n = pixels.length; i < n; i += 4) {
//              if (pixels[i] > 250){
//                probably_white_border++;
//              }
//            }
//
//            if (probably_white_border > 500){
//              //$("#item").append('<li><a href="'+probably_white_border+'"><img src="'+image.images.thumbnail.url+'" style="border:solid"></a></li>');
//              //fetch_image(tag, item);
//              return false;
//            }
//
//            // If image is validated, append it to the row,
//            $(item).html('<li><a href="'+image.link+'"><img src="'+image.images.thumbnail.url+'"></a></li>');
//            return true;
//          }, false);
//
//          img.crossOrigin="anonymous";
//          img.src = image.images.thumbnail.url;
//
//          // Since we add the images ourselves, always return false here.
//          return false;
//        },
//    });
//    afeed.run();
//  }



  function fetch_images(year) {

    var feed = new Instafeed({
        get       : 'tagged',
        tagName   : 'br책valla'+year,
        clientId  : 'eb01b1b10b72457ea650f74f756bde4a',
        sortBy    : 'random',
        links     : 'true',
        limit     : '3',
        mock      : 'true',

        success   : function(image){
          console.log(image);

          console.log(image.data);

          //shuffle(image.data);

          for (i = 0; i < image.data.length; i++) {
          //  console.log("Looping => "+image.data[i].link)
          //  validate_image(image.data[i]);
          $("#instafeed").append('<li><a href="'+image.data[i].link+'"><img src="'+image.data[i].images.thumbnail.url+'"></a></li>');
          }

          //console.log("Checking length of feed");

          //// Get images until we have 35 valid ones,
          //if ($("#instafeed li").length < 36){
          //  console.log("Total images is less than 35 so getting more...");
          //  //fetch_images(year);
          //  feed.next();
          //}
        },
    });

    feed.run();
  }

function shuffle(array) {
  var currentIndex = array.length, temporaryValue, randomIndex ;

  // While there remain elements to shuffle...
  while (0 !== currentIndex) {

    // Pick a remaining element...
    randomIndex = Math.floor(Math.random() * currentIndex);
    currentIndex -= 1;

    // And swap it with the current element.
    temporaryValue = array[currentIndex];
    array[currentIndex] = array[randomIndex];
    array[randomIndex] = temporaryValue;
  }

  return array;
}



  function validate_image(image){

    console.log(image.images.thumbnail.url)

    // Create new image,
    var img = new Image();

    // Add the eventlistener so we can paint the canvas when the image is ready,
    img.addEventListener("load", function() {

    // Draw the picture in the canvas element,
    var context = document.getElementById('canvas').getContext('2d');
        context.drawImage(img, 0, 0);

    // Get a rectangle 10 pixels wide from top to bottom,
    var pixels = context.getImageData(0, 0, 10, canvas.height).data;

    // Loop the pixels from the rectangle, if there is to much white we
    // *could be* dealing with a white frame, simply skip that image.
    // 500 is value that seems to do what I want, feel free to improve
    // this part though.
    var probably_white_border = 0;
    for (var i = 0, n = pixels.length; i < n; i += 4) {
      if (pixels[i] > 250){
        probably_white_border++;
      }
    }

    if (probably_white_border > 500){
      console.log("invalidating pic");
      $("#instafeed_ugly").append('<li><a href="'+probably_white_border+'"><img src="'+image.images.thumbnail.url+'" style="border:solid"></a></li>');
      return;
    }

    // Image is "all good", lets add it,
    add_image_to_row(image);

  }, false);

  img.crossOrigin="anonymous";
  img.src = image.images.thumbnail.url;
}


function add_image_to_row (image){
  $("#instafeed").append('<li><a href="'+image.link+'"><img src="'+image.images.thumbnail.url+'"></a></li>');
}


$( document ).ready(function() {
  fetch_images("2015");
});
        //template: '<li><a href="{{link}}"><img src="{{image}}"/></a></li>',

        // filter: function(image) {

        //   //console.log(image.images.thumbnail.url)
        //   var img = new Image();

        //   img.addEventListener("load", function() {

        //     // Draw the picture in the canvas element,
        //     var context = document.getElementById('canvas').getContext('2d');
        //         context.drawImage(img, 0, 0);

        //     // Get a rectangle 10 pixels wide from top to bottom,
        //     var pixels = context.getImageData(0, 0, 10, canvas.height).data;
        //         console.log(context);

        //     // Loop the pixels from the rectangle, if there is to much white we
        //     // *could be* dealing with a white frame, simply skip that image.
        //     // 500 is value that seems to do what I want, feel free to improve
        //     // this part though.
        //     var probably_white_border = 0;
        //     for (var i = 0, n = pixels.length; i < n; i += 4) {
        //       if (pixels[i] > 250){
        //         probably_white_border++;
        //       }
        //     }

        //     if (probably_white_border > 500){
        //       $("#instafeed_ugly").append('<li><a href="'+probably_white_border+'"><img src="'+image.images.thumbnail.url+'" style="border:solid"></a></li>');
        //       return false;
        //     }

        //     // If image is validated, append it to the row,
        //     $("#instafeed").append('<li><a href="'+image.link+'"><img src="'+image.images.thumbnail.url+'"></a></li>');
        //     return true;
        //   }, false);

        //   img.crossOrigin="anonymous";
        //   img.src = image.images.thumbnail.url;

        //   // Since we add the images ourselves, always return false here.
        //   return false;
        // },

</script>

</body>
</html>
